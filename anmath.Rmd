---
title: "Mini-project 2"
author: "Ankit Mathur"
date: "3/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, tidy = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(tidyverse)
library(broom)
library(arm)
cb_palette = c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

```{r}
WTHH_full = read_csv("DFP_WTHH_release.csv")
WTHH = WTHH_full[c("presvote16post", "house3", "weight_DFP", "M4A", "GREENJOB", "WEALTH", "MARLEG", "ICE", "GUNS", "POP_1", "POP_2", "POP_3")]
```

```{r}
WTHH$grp <- ifelse(WTHH$presvote16post==1 & WTHH$house3==1, "Loyal Democrats", ifelse(WTHH$presvote16post==2 & WTHH$house3==2, "Loyal Republicans", ifelse(!(WTHH$presvote16post %in% c(7,NA)), "Swing voters", NA)))
WTHH$swing_bhv <- ifelse(WTHH$grp=="Swing voters", ifelse(WTHH$house3==1, "Switch to D", ifelse(WTHH$house3==2, "Switch to R", "Others")), NA)

# cols <- c("presvote16post", "house3", "M4A", "GREENJOB", "WEALTH", "MARLEG", "ICE", "GUNS", "POP_1", "POP_2", "POP_3", "grp", "swing_bhv")
# WTHH[cols] <- lapply(WTHH[cols], factor)
```

# Solution 2:
```{r}
WTHH.long = gather(WTHH, key="issue", value="response",
                   c("M4A", "GREENJOB", "WEALTH", "MARLEG", "ICE", "GUNS"))
cols <- c("issue", "response")
WTHH.long[cols] <- lapply(WTHH.long[cols], factor)
WTHH.long <- WTHH.long[c("issue", "response", "grp", "weight_DFP")]
WTHH.long <- WTHH.long[!is.na(WTHH.long$response) & !is.na(WTHH.long$grp),]
```

```{r}
ggplot(WTHH.long, aes(x=response)) + stat_count(aes(fill=grp, weight=weight_DFP)) +
  facet_wrap(~issue) + scale_fill_manual(values=cb_palette) +
  labs(fill="Voter group", caption="1:Strongly support 2:Somewhat support 3:Neutral 4:Somewhat oppose 5:Strongly oppose 6:Not sure") +
  ggtitle("Distribution of voter groups by issue") +
  xlab("Response") + ylab("Number of voters")
```


With the exception of immigration issue (ICE), **Swing voters** tend to share *similar* opinions with **Loyal Democrats** across the remaining five issues. Interestingly, both these cohorts voted in favor of all five issues with a majority of voters choosing the *Strongly support* option. Having said this, an equivalent number of **Swing voters** chose *Strongly support* and *Strongly oppose* on the Medicare for all (M4A) issue, thereby showcasing a slightly different opinion than the **Loyal Democrats**.
As for the immigration issue, while **Loyal Democrats** do not seem to have any coherent opinion, both the **Loyal Democrats** and **Swing voters** cohorts voted against the defunding of ICE with a majority of them choosing the **Strongly oppose** option.

# Solution 3:
```{r}
WTHH$swing_voter = ifelse(WTHH$grp=="Swing voters", 1, ifelse(is.na(WTHH$grp), NA, 0))
WTHH.issue = WTHH[c("GREENJOB", "GUNS", "ICE", "M4A", "MARLEG", "WEALTH", "weight_DFP", "swing_voter")]
```

```{r}
WTHH.issue <- WTHH.issue[rowSums(WTHH.issue[,c(1,2,3,4,5,6)] == 6) == 0,]
WTHH.issue <- WTHH.issue[complete.cases(WTHH.issue),]
```

```{r}
WTHH.issue.long = gather(WTHH.issue, key="issue", value="response",
                   c("M4A", "GREENJOB", "WEALTH", "MARLEG", "ICE", "GUNS"))
ggplot(WTHH.issue.long, aes(x=response, y=swing_voter)) + geom_point(alpha=0.4) +
  geom_jitter(height=0.1, width=0.25) +
  geom_smooth(method = "glm", method.args = list(family = "binomial")) +
  facet_wrap(~issue)
```


```{r}
WTHH.issue.logit1 <- glm(swing_voter ~ WEALTH, weights=weight_DFP, family="quasibinomial", data=WTHH.issue)
display(WTHH.issue.logit1)
```

With just the GREENJOB issue as the predictor, we observe that:
$$
\textrm{logit[P(Swing voter)]} = -2.04 + 0.17 \times \textrm{GREENJOB}
$$
Using the "divide by 4" rule, we can say that moving one level closer to opposing the GREENJOB issue increases the model probability of being **Swing voter** by 4.25%

```{r}
WTHH.issue.logit2 <- glm(swing_voter ~ GREENJOB + GUNS, weights=weight_DFP, family="quasibinomial", data=WTHH.issue)
display(WTHH.issue.logit2)
```

With GREENJOB and GUNS issues as the predictors, we observe that:
$$
\textrm{logit[P(Swing voter)]} = -2.06 + 0.16 \times \textrm{GREENJOB} + 0.01 \times \textrm{GUNS}
$$
Using the "divide by 4" rule, we can say that moving one level closer to opposing the GREENJOB issue increases the model probability of being **Swing voter** by 4.25%

```{r}
WTHH.issue.logit <- glm(swing_voter ~ GREENJOB + GUNS + ICE + M4A + MARLEG + WEALTH, weights=weight_DFP, family="quasibinomial", data=WTHH.issue)
display(WTHH.issue.logit)
```

```{r}
# WTHH.issue.logit <- glm(swing_voter ~ GREENJOB * GUNS * ICE * M4A * MARLEG * WEALTH, weights=weight_DFP, family="quasibinomial", data=WTHH.issue)
# display(WTHH.issue.logit)
```

```{r}
WTHH.pop = WTHH[c("POP_1", "POP_2", "POP_3", "weight_DFP", "swing_voter")]
```

```{r}
WTHH.pop <- WTHH.pop[rowSums(WTHH.pop[,c(1,2,3)] == 6) == 0,]
WTHH.pop <- WTHH.pop[complete.cases(WTHH.pop),]
```

```{r}
WTHH.pop.long = gather(WTHH.pop, key="populism", value="response",
                   c("POP_1", "POP_2", "POP_3"))
ggplot(WTHH.pop.long, aes(x=response, y=swing_voter)) + geom_point(alpha=0.4) +
  geom_jitter(height=0.1, width=0.25) +
  geom_smooth(method = "glm", method.args = list(family = "binomial")) +
  facet_wrap(~populism)
```